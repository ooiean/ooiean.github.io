<html>

  <div id="result"></div>

  <script>
   (function(global) {

      var originalFetch = global.fetch;
      
      global.fetch = function(input, init) {
        
        // Allow HTTP requests
        url.replace('https://', 'http://'); 
        
        return originalFetch(input, init)
          .then(response => {
             // Check for errors and reject promise
             if (!response.ok) {
               throw Error(response.statusText); 
             }
             return response;
          });
    
      };
    
    })(window);
    
    async function callHelloAPI() {
      const url = "http://datamall2.mytransport.sg/ltaodataservice/BusArrivalv2?BusStopCode=65539"
      const headers = {
        'Content-Type': 'application/json',
        'AccountKey': 'sSlzPMS6RmCp/BX+DK0YRg==' 
      };
    
      const response = await fetch(url, {
        method: 'GET',
        headers: headers
      });
    
      if(!response.ok) {
        const message = `An error has occurred: ${response.status} - ${response.statusText}`;
        throw new Error(message);
      }
      const data = await response.text();
      
      document.getElementById('result').innerText = data;
    }
    callHelloAPI(); 
  </script>
</html>
